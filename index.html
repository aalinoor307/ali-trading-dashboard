<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TredLog – Trading Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      :root {
        --bg: #050816;
        --bg-soft: #0a1020;
        --card: #111827;
        --card-soft: #141b2f;
        --border: #1f2937;
        --accent: #ffc24b;
        --accent-strong: #f97316;
        --danger: #f97373;
        --muted: #9ca3af;
        --text: #f9fafb;
        --radius-lg: 18px;
        --radius-sm: 10px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          -apple-system, sans-serif;
        background: radial-gradient(circle at top, #172033 0, #050816 45%);
        color: var(--text);
      }

      body {
        display: flex;
        justify-content: center;
      }

      .page {
        width: 100%;
        max-width: 1200px;
        padding: 24px 16px 40px;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 18px;
      }

      .logo-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo-icon {
        width: 26px;
        height: 26px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 20%, #ffe29f, #ff9f4a 45%, #ff3c3c 100%);
        box-shadow: 0 0 0 3px rgba(255, 194, 75, 0.18);
      }

      .logo-text-main {
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      .logo-sub {
        font-size: 11px;
        color: var(--muted);
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .chip {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        color: var(--muted);
        background: rgba(15, 23, 42, 0.8);
      }

      .btn-small {
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(15, 23, 42, 0.9);
        color: var(--text);
        font-size: 11px;
        cursor: pointer;
      }

      .btn-small.primary {
        border: none;
        background: linear-gradient(90deg, #ffc24b, #f97316);
        color: #111827;
        font-weight: 500;
      }

      .btn-small:hover {
        filter: brightness(1.05);
      }

      main {
        display: grid;
        grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
        gap: 18px;
      }

      .card {
        background: linear-gradient(145deg, var(--card-soft), var(--card));
        border-radius: var(--radius-lg);
        border: 1px solid rgba(15, 23, 42, 0.9);
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
      }

      .card-inner {
        padding: 18px 18px 16px;
      }

      /* LEFT COLUMN */

      .left-col {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .section-title-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .section-title {
        font-size: 13px;
        font-weight: 600;
      }

      .section-sub {
        font-size: 11px;
        color: var(--muted);
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 10px;
        margin-bottom: 10px;
      }

      .form-grid-wide {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 10px;
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .label {
        font-size: 11px;
        color: var(--muted);
      }

      input[type="text"],
      input[type="number"],
      input[type="date"],
      select,
      textarea {
        border-radius: 999px;
        border: 1px solid rgba(55, 65, 81, 0.9);
        background: rgba(15, 23, 42, 0.95);
        color: var(--text);
        padding: 7px 11px;
        font-size: 12px;
        outline: none;
      }

      textarea {
        border-radius: 14px;
        min-height: 80px;
        resize: vertical;
      }

      input::placeholder,
      textarea::placeholder {
        color: rgba(156, 163, 175, 0.7);
      }

      .btn-row {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        margin-top: 8px;
      }

      .btn-main {
        padding: 8px 16px;
        border-radius: 999px;
        border: none;
        background: linear-gradient(90deg, #ffc24b, #f97316);
        color: #111827;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
      }

      .btn-secondary {
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: rgba(15, 23, 42, 0.9);
        color: var(--muted);
        font-size: 12px;
        cursor: pointer;
      }

      .btn-main:hover,
      .btn-secondary:hover {
        filter: brightness(1.05);
      }

      .checklist-columns {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
        margin-top: 8px;
      }

      .checklist-group-title {
        font-size: 11px;
        color: var(--muted);
        margin-bottom: 4px;
      }

      .checklist-group {
        border-radius: var(--radius-sm);
        border: 1px solid rgba(31, 41, 55, 0.9);
        background: rgba(15, 23, 42, 0.9);
        padding: 8px 9px;
      }

      .checklist-item {
        display: flex;
        align-items: flex-start;
        gap: 6px;
        font-size: 11px;
        margin-bottom: 4px;
      }

      .checklist-item input {
        margin-top: 1px;
      }

      .checklist-footer {
        margin-top: 8px;
        font-size: 10px;
        color: var(--muted);
      }

      /* RIGHT COLUMN */

      .right-col {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 10px;
        margin-top: 8px;
      }

      .metric-card {
        border-radius: var(--radius-sm);
        padding: 10px 10px;
        border: 1px solid rgba(31, 41, 55, 0.95);
        background: radial-gradient(circle at top, #1f2937, #020617 80%);
      }

      .metric-label {
        font-size: 10px;
        color: var(--muted);
        margin-bottom: 3px;
      }

      .metric-value {
        font-size: 16px;
        font-weight: 600;
      }

      .metric-foot {
        font-size: 10px;
        color: var(--muted);
        margin-top: 4px;
      }

      .metric-value.good {
        color: #4ade80;
      }

      .metric-value.bad {
        color: #f97373;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 11px;
      }

      thead {
        color: var(--muted);
      }

      th,
      td {
        padding: 6px 6px;
        border-bottom: 1px solid rgba(31, 41, 55, 0.9);
        text-align: left;
      }

      tbody tr:hover {
        background: rgba(15, 23, 42, 0.7);
      }

      .tag-win {
        color: #22c55e;
      }

      .tag-loss {
        color: #f97373;
      }

      footer {
        margin-top: 20px;
        font-size: 10px;
        color: var(--muted);
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 8px;
      }

      footer a {
        color: var(--accent);
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }

      @media (max-width: 1024px) {
        main {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      @media (max-width: 640px) {
        header {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .form-grid,
        .form-grid-wide,
        .metrics-grid,
        .checklist-columns {
          grid-template-columns: minmax(0, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <div class="logo-row">
          <div class="logo-icon"></div>
          <div>
            <div class="logo-text-main">TredLog</div>
            <div class="logo-sub">Probability-driven trading journal – Dashboard</div>
          </div>
        </div>
        <div class="header-actions">
          <span class="chip" id="signedInChip">Signed in as: Guest</span>
          <button
            class="btn-small"
            onclick="window.open('https://tredlog.com', '_blank')"
          >
            Back to landing
          </button>
          <button class="btn-small primary" onclick="handleLogout()">Log out</button>
        </div>
      </header>

      <main>
        <!-- LEFT COLUMN -->
        <section class="left-col">
          <!-- New trade -->
          <div class="card">
            <div class="card-inner">
              <div class="section-title-row">
                <div>
                  <div class="section-title">New trade</div>
                  <div class="section-sub">
                    Log a setup, score it and add it to your journal.
                  </div>
                </div>
              </div>

              <div class="form-grid">
                <div class="field">
                  <label class="label" for="tradeDate">Date</label>
                  <input type="date" id="tradeDate" />
                </div>
                <div class="field">
                  <label class="label" for="pair">Pair / symbol</label>
                  <input type="text" id="pair" placeholder="e.g. GBPUSD" />
                </div>
                <div class="field">
                  <label class="label" for="direction">Direction</label>
                  <select id="direction">
                    <option value="">Select</option>
                    <option value="Buy">Buy</option>
                    <option value="Sell">Sell</option>
                  </select>
                </div>
              </div>

              <div class="form-grid">
                <div class="field">
                  <label class="label" for="riskR">Risk (R)</label>
                  <input type="number" step="0.01" id="riskR" value="1" />
                </div>
                <div class="field">
                  <label class="label" for="session">Session</label>
                  <select id="session">
                    <option value="">Select</option>
                    <option>London</option>
                    <option>New York</option>
                    <option>Asia</option>
                    <option>Other</option>
                  </select>
                </div>
                <div class="field">
                  <label class="label" for="resultR">Result (R)</label>
                  <input
                    type="number"
                    step="0.01"
                    id="resultR"
                    placeholder="e.g. -1, 0.5, 2"
                  />
                </div>
              </div>

              <div class="form-grid-wide">
                <div class="field">
                  <label class="label" for="location">Location / tag</label>
                  <input
                    type="text"
                    id="location"
                    placeholder="Desk, prop office, travelling..."
                  />
                </div>
                <div class="field">
                  <label class="label" for="setup">Setup</label>
                  <input
                    type="text"
                    id="setup"
                    placeholder="Momentum, pullback, range break..."
                  />
                </div>
              </div>

              <div class="field">
                <label class="label" for="notes">Journal notes</label>
                <textarea
                  id="notes"
                  placeholder="What did you see? What rules were met? Where could you improve?"
                ></textarea>
              </div>

              <div class="btn-row">
                <button class="btn-secondary" onclick="handleSaveDraft()">Save draft</button>
                <button class="btn-main" onclick="handleAddTrade()">Add trade to log</button>
              </div>
            </div>
          </div>

          <!-- Weighted checklist -->
          <div class="card">
            <div class="card-inner">
              <div class="section-title-row">
                <div>
                  <div class="section-title">Weighted checklist</div>
                  <div class="section-sub">
                    Tick only what actually happened on this trade.
                  </div>
                </div>
                <div class="chip">Daily logging habit</div>
              </div>

              <div class="checklist-columns">
                <div>
                  <div class="checklist-group">
                    <div class="checklist-group-title">Momentum setup</div>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>Trend, pullback clean and strong close.</span>
                    </label>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>Clean level of risk. No double wick at level.</span>
                    </label>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>No long wick against direction.</span>
                    </label>
                  </div>

                  <div class="checklist-group" style="margin-top: 8px">
                    <div class="checklist-group-title">Screenshots / review</div>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>Screenshots saved for review.</span>
                    </label>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>Annotated before &amp; after.</span>
                    </label>
                  </div>
                </div>

                <div>
                  <div class="checklist-group">
                    <div class="checklist-group-title">Risk &amp; discipline</div>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>Planned R respected.</span>
                    </label>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>No revenge trades.</span>
                    </label>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>No adding risk mid-trade.</span>
                    </label>
                  </div>

                  <div class="checklist-group" style="margin-top: 8px">
                    <div class="checklist-group-title">Behaviour</div>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>Planned session only (no FOMO late session).</span>
                    </label>
                    <label class="checklist-item">
                      <input type="checkbox" class="cl-item" data-weight="1" />
                      <span>Clear headspace (no external stress).</span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="checklist-footer">
                0 / <span id="totalRules">0</span> rules followed (100 = higher discipline).
              </div>
            </div>
          </div>
        </section>

        <!-- RIGHT COLUMN -->
        <section class="right-col">
          <!-- Metrics -->
          <div class="card">
            <div class="card-inner">
              <div class="section-title-row">
                <div>
                  <div class="section-title">Equity &amp; discipline overview</div>
                  <div class="section-sub">
                    High-level view of your recent performance.
                  </div>
                </div>
                <span class="chip" id="tradeCountChip">0 trades logged</span>
              </div>

              <div class="metrics-grid">
                <div class="metric-card">
                  <div class="metric-label">WIN RATE</div>
                  <div class="metric-value good" id="winRate">0%</div>
                  <div class="metric-foot">Based on R &gt; 0.</div>
                </div>
                <div class="metric-card">
                  <div class="metric-label">AVG R (REALIZED)</div>
                  <div class="metric-value" id="avgR">0.0R</div>
                  <div class="metric-foot">Equity curve will show here.</div>
                </div>
                <div class="metric-card">
                  <div class="metric-label">DISCIPLINE SCORE</div>
                  <div class="metric-value" id="disciplineScore">0 / 100</div>
                  <div class="metric-foot">Based on checklist hits.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent trades -->
          <div class="card">
            <div class="card-inner">
              <div class="section-title-row">
                <div>
                  <div class="section-title">Recent trades</div>
                  <div class="section-sub">Use the table to see streaks and R distribution.</div>
                </div>
              </div>

              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Date</th>
                    <th>Pair</th>
                    <th>Dir</th>
                    <th>R risked</th>
                    <th>Result</th>
                    <th>Discipline</th>
                  </tr>
                </thead>
                <tbody id="tradesBody">
                  <tr>
                    <td colspan="7" style="text-align: center; padding: 10px 0; color: var(--muted)">
                      No trades logged yet. Add one on the left.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <div>© 2025 TredLog. All rights reserved.</div>
        <div>
          Contact:
          <a href="mailto:support@tredlog.com">support@tredlog.com</a>
        </div>
      </footer>
    </div>

    <script>
      const STORAGE_KEY = "tredlog_trades_v1";

      function todayISO() {
        return new Date().toISOString().slice(0, 10);
      }

      function loadTrades() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          return JSON.parse(raw) || [];
        } catch (e) {
          console.error("Failed to parse stored trades:", e);
          return [];
        }
      }

      function saveTrades(trades) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(trades));
      }

      function computeDisciplineFromChecklist() {
        const items = Array.from(document.querySelectorAll(".cl-item"));
        const total = items.length;
        const checked = items.filter((i) => i.checked).length;
        document.getElementById("totalRules").textContent = String(total);
        if (!total) return 0;
        return Math.round((checked / total) * 100);
      }

      function renderMetrics(trades) {
        const count = trades.length;
        document.getElementById("tradeCountChip").textContent =
          count + (count === 1 ? " trade logged" : " trades logged");

        if (!count) {
          document.getElementById("winRate").textContent = "0%";
          document.getElementById("avgR").textContent = "0.0R";
          document.getElementById("disciplineScore").textContent = "0 / 100";
          return;
        }

        let wins = 0;
        let sumR = 0;
        let sumDisc = 0;
        trades.forEach((t) => {
          if (t.resultR > 0) wins++;
          sumR += t.resultR;
          sumDisc += t.disciplineScore || 0;
        });

        const winRate = Math.round((wins / count) * 100);
        const avgR = sumR / count;
        const avgDisc = Math.round(sumDisc / count);

        const winRateEl = document.getElementById("winRate");
        winRateEl.textContent = winRate + "%";
        winRateEl.classList.toggle("good", winRate >= 50);
        winRateEl.classList.toggle("bad", winRate < 50);

        document.getElementById("avgR").textContent = avgR.toFixed(2) + "R";
        document.getElementById("disciplineScore").textContent = avgDisc + " / 100";
      }

      function renderTrades(trades) {
        const tbody = document.getElementById("tradesBody");
        tbody.innerHTML = "";

        if (!trades.length) {
          const row = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 7;
          td.style.textAlign = "center";
          td.style.padding = "10px 0";
          td.style.color = "var(--muted)";
          td.textContent = "No trades logged yet. Add one on the left.";
          row.appendChild(td);
          tbody.appendChild(row);
          return;
        }

        trades
          .slice()
          .reverse()
          .forEach((t, idx) => {
            const row = document.createElement("tr");

            function addCell(text, className) {
              const td = document.createElement("td");
              td.textContent = text;
              if (className) td.className = className;
              row.appendChild(td);
            }

            addCell(String(trades.length - idx), "");
            addCell(t.date || "", "");
            addCell(t.pair || "", "");
            addCell(t.direction || "", "");
            addCell((t.riskR || 0).toFixed(2), "");
            const resultLabel = t.resultR > 0 ? "+" + t.resultR.toFixed(2) : t.resultR.toFixed(2);
            addCell(
              resultLabel,
              t.resultR > 0 ? "tag-win" : t.resultR < 0 ? "tag-loss" : ""
            );
            addCell((t.disciplineScore || 0) + "%", "");
            tbody.appendChild(row);
          });
      }

      function refresh() {
        const trades = loadTrades();
        renderMetrics(trades);
        renderTrades(trades);
        computeDisciplineFromChecklist();
      }

      function handleAddTrade() {
        const trades = loadTrades();

        const date = document.getElementById("tradeDate").value || todayISO();
        const pair = document.getElementById("pair").value.trim();
        const direction = document.getElementById("direction").value;
        const riskR = parseFloat(document.getElementById("riskR").value || "0");
        const session = document.getElementById("session").value;
        const resultR = parseFloat(document.getElementById("resultR").value || "0");
        const location = document.getElementById("location").value.trim();
        const setup = document.getElementById("setup").value.trim();
        const notes = document.getElementById("notes").value.trim();
        const disciplineScore = computeDisciplineFromChecklist();

        if (!pair || !direction) {
          alert("Please fill at least pair and direction.");
          return;
        }

        const trade = {
          id: Date.now(),
          date,
          pair,
          direction,
          riskR,
          session,
          resultR,
          location,
          setup,
          notes,
          disciplineScore,
        };

        trades.push(trade);
        saveTrades(trades);

        // clear form but keep date/session defaults
        document.getElementById("pair").value = "";
        document.getElementById("direction").value = "";
        document.getElementById("riskR").value = "1";
        document.getElementById("resultR").value = "";
        document.getElementById("location").value = "";
        document.getElementById("setup").value = "";
        document.getElementById("notes").value = "";
        document
          .querySelectorAll(".cl-item")
          .forEach((i) => (i.checked = false));

        refresh();
      }

      function handleSaveDraft() {
        alert(
          "Draft saving is local-only. You can just leave the page open or use your own storage later."
        );
      }

      function handleLogout() {
        if (!confirm("This only clears local data in this browser. Continue?")) return;
        localStorage.removeItem(STORAGE_KEY);
        refresh();
        alert("Local trades cleared. You are effectively logged out on this device.");
      }

      // Init
      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("tradeDate").value = todayISO();
        refresh();
      });
    </script>
  </body>
</html>
