<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TredLog – Trading Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #050816;
      --bg-elevated: #101322;
      --bg-card: rgba(15, 23, 42, 0.96);
      --border-subtle: rgba(148, 163, 184, 0.28);
      --accent: #ffc24b;
      --accent-2: #ff9a3c;
      --accent-blue: #2563eb;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      background: radial-gradient(circle at top, #1b2338 0, #050816 55%);
      color: var(--text);
    }

    .app-shell {
      max-width: 1220px;
      margin: 0 auto;
      padding: 20px 18px 40px;
    }

    /* Top bar */

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .logo-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ffe29f, #ff9f4a 45%, #ff3c3c 100%);
      box-shadow: 0 0 0 4px rgba(255, 194, 75, 0.18);
    }

    .logo-text-main {
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .logo-text-sub {
      font-size: 11px;
      color: var(--muted);
    }

    .top-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
    }

    .pill {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.85);
      color: var(--muted);
    }

    .user-pill {
      border-color: rgba(56, 189, 248, 0.7);
      background: rgba(8, 47, 73, 0.85);
      color: #e0f2fe;
    }

    /* Layout */

    .dashboard-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(0, 1fr);
      gap: 18px;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius);
      border: 1px solid var(--border-subtle);
      padding: 14px 16px 16px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .card-sub {
      font-size: 11px;
      color: var(--muted);
    }

    /* Left column: New trade + checklist */

    .left-column {
      display: grid;
      grid-template-rows: auto auto;
      gap: 14px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 8px;
    }

    label.form-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 3px;
      display: block;
    }

    input, select, textarea {
      width: 100%;
      padding: 7px 9px;
      font-size: 12px;
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.85);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text);
      outline: none;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148, 163, 184, 0.75);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      max-height: 180px;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .btn-primary,
    .btn-secondary {
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      padding: 8px 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #111827;
      box-shadow: 0 9px 20px rgba(255, 194, 75, 0.32);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .btn-primary:hover { filter: brightness(1.05); }
    .btn-secondary:hover { border-color: rgba(248, 250, 252, 0.7); }

    /* Checklist card */

    .checklist-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .check-item {
      font-size: 11px;
      padding: 6px 7px;
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.95);
      display: flex;
      align-items: flex-start;
      gap: 6px;
      color: var(--muted);
    }

    .check-item input {
      margin-top: 1px;
      width: auto;
    }

    .check-footer {
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
    }

    /* Right column: overview */

    .overview-metrics {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 12px;
    }

    .metric {
      padding: 8px 9px;
      border-radius: 12px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: radial-gradient(circle at top left, #111827, #020617 70%);
      font-size: 11px;
    }

    .metric-label {
      color: var(--muted);
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 15px;
      font-weight: 600;
    }

    .metric-note {
      margin-top: 4px;
      font-size: 10px;
      color: var(--muted);
    }

    .recent-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-top: 8px;
    }

    .recent-table th,
    .recent-table td {
      padding: 6px 4px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      text-align: left;
    }

    .recent-table th {
      color: var(--muted);
      font-weight: 500;
      font-size: 10px;
      text-transform: uppercase;
    }

    .badge-win {
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.15);
      color: #bbf7d0;
      border: 1px solid rgba(22, 163, 74, 0.7);
      font-size: 10px;
    }

    .badge-loss {
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(220, 38, 38, 0.18);
      color: #fecaca;
      border: 1px solid rgba(239, 68, 68, 0.7);
      font-size: 10px;
    }

    footer {
      margin-top: 24px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
    }

    @media (max-width: 980px) {
      .dashboard-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      .overview-metrics {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .checklist-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .overview-metrics {
        grid-template-columns: minmax(0, 1fr);
      }

      .checklist-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- TOP BAR -->
    <header class="topbar">
      <div class="logo-row">
        <div class="logo-icon"></div>
        <div>
          <div class="logo-text-main">TredLog</div>
          <div class="logo-text-sub">Probability-driven trading dashboard</div>
        </div>
      </div>
      <div class="top-right">
        <div class="pill">Local session · Data stored in your browser</div>
        <div class="pill user-pill">Signed in locally</div>
      </div>
    </header>

    <!-- MAIN GRID -->
    <main class="dashboard-grid">
      <!-- LEFT: new trade + checklist -->
      <div class="left-column">
        <!-- NEW TRADE CARD -->
        <section class="card">
          <div class="card-header">
            <div class="card-title">New trade</div>
            <div class="card-sub">Log a setup, score it and add it to your journal.</div>
          </div>

          <div class="form-grid">
            <div>
              <label class="form-label" for="pairInput">Pair / Symbol</label>
              <input id="pairInput" placeholder="e.g. GBPUSD" />
            </div>
            <div>
              <label class="form-label" for="directionSelect">Direction</label>
              <select id="directionSelect">
                <option value="">Select</option>
                <option value="Buy">Buy</option>
                <option value="Sell">Sell</option>
              </select>
            </div>
            <div>
              <label class="form-label" for="riskInput">Risk (R)</label>
              <input id="riskInput" type="number" step="0.01" placeholder="1.0" />
            </div>
          </div>

          <div class="form-grid">
            <div>
              <label class="form-label" for="sessionInput">Session</label>
              <input id="sessionInput" placeholder="London / NY / Asia..." />
            </div>
            <div>
              <label class="form-label" for="setupInput">Setup</label>
              <input id="setupInput" placeholder="Momentum, Reversal..." />
            </div>
            <div>
              <label class="form-label" for="resultTypeSelect">Result</label>
              <select id="resultTypeSelect">
                <option value="Win">Win</option>
                <option value="Loss">Loss</option>
                <option value="BE">Break-even</option>
              </select>
            </div>
          </div>

          <div class="form-grid">
            <div>
              <label class="form-label" for="resultRInput">Result (R)</label>
              <input id="resultRInput" type="number" step="0.01" placeholder="e.g. 1.5" />
            </div>
            <div style="grid-column: span 2;">
              <label class="form-label" for="notesInput">Journal notes</label>
              <textarea id="notesInput" placeholder="What did you see? What rules were met? Where could you improve?"></textarea>
            </div>
          </div>

          <div class="btn-row">
            <button class="btn-secondary" type="button" onclick="saveDraft()">Save draft</button>
            <button class="btn-primary" type="button" onclick="addTrade()">Add trade to log</button>
          </div>
        </section>

        <!-- CHECKLIST CARD -->
        <section class="card">
          <div class="card-header">
            <div class="card-title">Weighted checklist</div>
            <div class="card-sub">Tick only what actually happened on this trade.</div>
          </div>

          <div class="checklist-grid">
            <label class="check-item">
              <input type="checkbox" class="check-input" />
              Momentum setup, clean level and strong close.
            </label>
            <label class="check-item">
              <input type="checkbox" class="check-input" />
              Clean close at level – no double add at level.
            </label>
            <label class="check-item">
              <input type="checkbox" class="check-input" />
              No long wick against direction into level.
            </label>
            <label class="check-item">
              <input type="checkbox" class="check-input" />
              Planned R respected – no revenge trades.
            </label>
            <label class="check-item">
              <input type="checkbox" class="check-input" />
              Screenshots saved.
            </label>
            <label class="check-item">
              <input type="checkbox" class="check-input" />
              No random adds or trades outside plan.
            </label>
          </div>

          <div class="check-footer" id="checklistSummary">
            0 / 6 rules followed (0%). Higher score → higher discipline.
          </div>
        </section>
      </div>

      <!-- RIGHT: overview -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">Equity & discipline overview</div>
          <div class="card-sub">High-level view of your recent performance.</div>
        </div>

        <div class="overview-metrics">
          <div class="metric">
            <div class="metric-label">Win rate</div>
            <div class="metric-value" id="winrateValue">0%</div>
            <div class="metric-note" id="tradesCountNote">0 trades logged</div>
          </div>
          <div class="metric">
            <div class="metric-label">Average R realized</div>
            <div class="metric-value" id="avgRValue">0.00R</div>
            <div class="metric-note">Equity curve will show here.</div>
          </div>
          <div class="metric">
            <div class="metric-label">Discipline score</div>
            <div class="metric-value" id="discValue">0 / 100</div>
            <div class="metric-note">Based on checklist hits.</div>
          </div>
        </div>

        <div class="card-header" style="margin-top: 8px;">
          <div class="card-title" style="font-size: 13px;">Recent trades</div>
          <div class="card-sub">Last 10 trades – stored locally in this browser.</div>
        </div>

        <table class="recent-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Pair</th>
              <th>Dir</th>
              <th>Risk</th>
              <th>Result (R)</th>
              <th>Discipline</th>
            </tr>
          </thead>
          <tbody id="recentBody"></tbody>
        </table>
      </section>
    </main>

    <footer>
      © 2025 TredLog. All data is stored locally in your browser.
    </footer>
  </div>

  <script>
    const STORAGE_KEY = "tredlog_v2_trades";
    const DRAFT_KEY = "tredlog_v2_draft";

    function loadTrades() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      } catch (e) {
        return [];
      }
    }

    function saveTrades(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    function readChecklist() {
      const boxes = Array.from(document.querySelectorAll(".check-input"));
      const total = boxes.length;
      const hits = boxes.filter(b => b.checked).length;
      return { hits, total };
    }

    function updateChecklistSummary() {
      const { hits, total } = readChecklist();
      const pct = total ? Math.round((hits / total) * 100) : 0;
      document.getElementById("checklistSummary").textContent =
        `${hits} / ${total} rules followed (${pct}%). Higher score → higher discipline.`;
    }

    document.querySelectorAll(".check-input").forEach(cb => {
      cb.addEventListener("change", updateChecklistSummary);
    });

    function getFormValues() {
      return {
        pair: document.getElementById("pairInput").value.trim(),
        direction: document.getElementById("directionSelect").value,
        risk: parseFloat(document.getElementById("riskInput").value),
        session: document.getElementById("sessionInput").value.trim(),
        setup: document.getElementById("setupInput").value.trim(),
        resultType: document.getElementById("resultTypeSelect").value,
        resultR: parseFloat(document.getElementById("resultRInput").value),
        notes: document.getElementById("notesInput").value.trim(),
      };
    }

    function clearForm() {
      document.getElementById("pairInput").value = "";
      document.getElementById("directionSelect").value = "";
      document.getElementById("riskInput").value = "";
      document.getElementById("resultRInput").value = "";
      document.getElementById("resultTypeSelect").value = "Win";
      document.getElementById("notesInput").value = "";

      document.querySelectorAll(".check-input").forEach(cb => cb.checked = false);
      updateChecklistSummary();
      localStorage.removeItem(DRAFT_KEY);
    }

    function saveDraft() {
      const values = getFormValues();
      localStorage.setItem(DRAFT_KEY, JSON.stringify(values));
      alert("Draft saved locally in this browser.");
    }

    function loadDraftIfAny() {
      try {
        const raw = localStorage.getItem(DRAFT_KEY);
        if (!raw) return;
        const d = JSON.parse(raw);
        if (d.pair !== undefined) document.getElementById("pairInput").value = d.pair;
        if (d.direction !== undefined) document.getElementById("directionSelect").value = d.direction;
        if (!isNaN(d.risk)) document.getElementById("riskInput").value = d.risk;
        if (d.session !== undefined) document.getElementById("sessionInput").value = d.session;
        if (d.setup !== undefined) document.getElementById("setupInput").value = d.setup;
        if (d.resultType !== undefined) document.getElementById("resultTypeSelect").value = d.resultType;
        if (!isNaN(d.resultR)) document.getElementById("resultRInput").value = d.resultR;
        if (d.notes !== undefined) document.getElementById("notesInput").value = d.notes;
      } catch (e) {
        // ignore broken draft
      }
    }

    function addTrade() {
      const values = getFormValues();
      if (!values.pair || !values.direction || isNaN(values.risk) || isNaN(values.resultR)) {
        alert("Please fill Pair, Direction, Risk and Result (R).");
        return;
      }

      const { hits, total } = readChecklist();
      const trade = {
        id: Date.now(),
        date: new Date().toLocaleDateString(),
        ...values,
        checklistHits: hits,
        checklistTotal: total
      };

      const list = loadTrades();
      list.unshift(trade);
      saveTrades(list);
      clearForm();
      render();
      alert("Trade added to log.");
    }

    function render() {
      const list = loadTrades();
      const total = list.length;

      const winrateEl = document.getElementById("winrateValue");
      const avgREl = document.getElementById("avgRValue");
      const discEl = document.getElementById("discValue");
      const tradesNoteEl = document.getElementById("tradesCountNote");
      const body = document.getElementById("recentBody");

      if (!total) {
        winrateEl.textContent = "0%";
        avgREl.textContent = "0.00R";
        discEl.textContent = "0 / 100";
        tradesNoteEl.textContent = "0 trades logged";
        body.innerHTML = "";
        return;
      }

      let wins = 0;
      let sumR = 0;
      let discSum = 0;
      let discCount = 0;

      list.forEach(t => {
        if (t.resultR > 0) wins++;
        sumR += t.resultR;
        if (t.checklistTotal > 0) {
          discSum += (t.checklistHits / t.checklistTotal) * 100;
          discCount++;
        }
      });

      const winrate = Math.round((wins / total) * 100);
      const avgR = sumR / total;
      const discScore = discCount ? Math.round(discSum / discCount) : 0;

      winrateEl.textContent = `${winrate}%`;
      avgREl.textContent = `${avgR.toFixed(2)}R`;
      discEl.textContent = `${discScore} / 100`;
      tradesNoteEl.textContent = `${total} trade${total === 1 ? "" : "s"} logged`;

      const rows = list.slice(0, 10).map(t => {
        const discPct = t.checklistTotal
          ? Math.round((t.checklistHits / t.checklistTotal) * 100)
          : 0;
        const badgeClass = t.resultR > 0 ? "badge-win" : t.resultR < 0 ? "badge-loss" : "";
        const badgeLabel = t.resultR > 0 ? "Win" : t.resultR < 0 ? "Loss" : t.resultType || "";
        return `
          <tr>
            <td>${t.date}</td>
            <td>${t.pair}</td>
            <td>${t.direction}</td>
            <td>${isNaN(t.risk) ? "-" : t.risk}</td>
            <td>
              <span class="${badgeClass}">${badgeLabel}</span>
              &nbsp;${isNaN(t.resultR) ? "" : `${t.resultR}R`}
            </td>
            <td>${discPct}%</td>
          </tr>`;
      }).join("");

      body.innerHTML = rows;
    }

    loadDraftIfAny();
    updateChecklistSummary();
    render();
  </script>
</body>
</html>
